import com.google.gson.*;
import com.google.gson.reflect.*;
import java.util.*;
import java.util.concurrent.TimeUnit;
import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.awt.Color;
import java.util.prefs.*;
import java.time.*;
import java.io.IOException;
import java.io.FileWriter;


public class ClockIn extends javax.swing.JFrame {
    private static Preferences prefs;
    static HashMap<Integer, ArrayList<Long>> hourLog = new HashMap<Integer, ArrayList<Long>>();
    private Boolean isClockedIn = false;
    long lastActiveDate = getCurrentTime();
    long clockedInTime = 0;
    long timeWorkedToday = 0;
    long timeWorkedInWeek = 0;
    static Gson gson = new Gson();

    public ClockIn() {
        initComponents();
        setInterval(1000);
        prefs = Preferences.userNodeForPackage(this.getClass());
        getPrefs(prefs);
        reconcileLastActiveDate();
        setUIStateFromPrefs();
        if (clockedInTime == 0) {
            clockInOutAtLabel.setText("Currently clocked out");
            clockInOutAtTime.setText("");
        }


        Runtime.getRuntime().addShutdownHook(new Thread() {
            @Override
            public void run() {
                prefs.put("hourLog", gson.toJson(hourLog));
                prefs.putLong("lastActiveDate", lastActiveDate);
                prefs.putLong("timeWorkedToday", timeWorkedToday);
                prefs.putLong("timeWorkedInWeek", timeWorkedInWeek);
            }

        });

    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">
    private void initComponents() {

        jSeparator3 = new javax.swing.JSeparator();
        jTabbedPane3 = new javax.swing.JTabbedPane();
        tab1 = new javax.swing.JPanel();
        clockinBtn = new javax.swing.JButton();
        dayHoursLabel = new javax.swing.JLabel();
        weekHoursLabel = new javax.swing.JLabel();
        dayHours = new javax.swing.JLabel();
        weekHours = new javax.swing.JLabel();
        clockInOutAtLabel = new javax.swing.JLabel();
        clockInOutAtTime = new javax.swing.JLabel();
        tab2 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        jTextField1 = new javax.swing.JTextField();
        jLabel8 = new javax.swing.JLabel();
        jLabel9 = new javax.swing.JLabel();
        jSeparator1 = new javax.swing.JSeparator();
        jTextField2 = new javax.swing.JTextField();
        jComboBox1 = new javax.swing.JComboBox<>();
        jComboBox2 = new javax.swing.JComboBox<>();
        jLabel10 = new javax.swing.JLabel();
        jLabel11 = new javax.swing.JLabel();
        jTextField3 = new javax.swing.JTextField();
        jTextField4 = new javax.swing.JTextField();
        jComboBox3 = new javax.swing.JComboBox<>();
        jComboBox4 = new javax.swing.JComboBox<>();
        jLabel2 = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("Clock In");

        tab1.setBackground(new java.awt.Color(255, 255, 255));

        clockinBtn.setBackground(new java.awt.Color(68, 214, 149));
        clockinBtn.setText("CLOCK IN");
        clockinBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                clockinBtnActionPerformed(evt);
            }
        });

        dayHoursLabel.setText("Time worked today:");

        weekHoursLabel.setText("Time worked this week:");

        dayHours.setText("8");

        weekHours.setText("34");

        clockInOutAtLabel.setText("Clocked In At:");

        clockInOutAtTime.setText("12:00");

        javax.swing.GroupLayout tab1Layout = new javax.swing.GroupLayout(tab1);
        tab1.setLayout(tab1Layout);
        tab1Layout.setHorizontalGroup(
            tab1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(tab1Layout.createSequentialGroup()
                .addGroup(tab1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(tab1Layout.createSequentialGroup()
                        .addGap(186, 186, 186)
                        .addGroup(tab1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(weekHoursLabel)
                            .addComponent(dayHoursLabel)
                            .addComponent(clockInOutAtLabel))
                        .addGap(18, 18, 18)
                        .addGroup(tab1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(weekHours)
                            .addComponent(dayHours)
                            .addComponent(clockInOutAtTime)))
                    .addGroup(tab1Layout.createSequentialGroup()
                        .addGap(254, 254, 254)
                        .addComponent(clockinBtn, javax.swing.GroupLayout.PREFERRED_SIZE, 175, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addGap(334, 334, 334))
        );
        tab1Layout.setVerticalGroup(
            tab1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(tab1Layout.createSequentialGroup()
                .addGap(91, 91, 91)
                .addComponent(clockinBtn, javax.swing.GroupLayout.PREFERRED_SIZE, 63, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addGroup(tab1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(clockInOutAtLabel)
                    .addComponent(clockInOutAtTime))
                .addGap(15, 15, 15)
                .addGroup(tab1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(dayHoursLabel)
                    .addComponent(dayHours))
                .addGap(18, 18, 18)
                .addGroup(tab1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(weekHoursLabel)
                    .addComponent(weekHours))
                .addContainerGap(308, Short.MAX_VALUE))
        );

        jTabbedPane3.addTab("ClockIn/ClockOut", tab1);

        tab2.setBackground(new java.awt.Color(255, 255, 255));

        jLabel1.setFont(new java.awt.Font("Verdana", 1, 18)); // NOI18N
        jLabel1.setText("MONDAY");

        jTextField1.setMinimumSize(new java.awt.Dimension(50, 26));
        jTextField1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField1ActionPerformed(evt);
            }
        });

        jLabel8.setText("In:");

        jLabel9.setText("Out:");

        jTextField2.setMinimumSize(new java.awt.Dimension(50, 26));
        jTextField2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField2ActionPerformed(evt);
            }
        });

        jComboBox1.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "AM", "PM" }));
        jComboBox1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jComboBox1ActionPerformed(evt);
            }
        });

        jComboBox2.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "AM", "PM" }));
        jComboBox2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jComboBox2ActionPerformed(evt);
            }
        });

        jLabel10.setText("In:");

        jLabel11.setText("Out:");

        jTextField3.setMinimumSize(new java.awt.Dimension(50, 26));
        jTextField3.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField3ActionPerformed(evt);
            }
        });

        jTextField4.setMinimumSize(new java.awt.Dimension(50, 26));
        jTextField4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jTextField4ActionPerformed(evt);
            }
        });

        jComboBox3.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "AM", "PM" }));
        jComboBox3.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jComboBox3ActionPerformed(evt);
            }
        });

        jComboBox4.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "AM", "PM" }));
        jComboBox4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jComboBox4ActionPerformed(evt);
            }
        });

        jLabel2.setFont(new java.awt.Font("Verdana", 1, 18)); // NOI18N
        jLabel2.setText("0");

        javax.swing.GroupLayout tab2Layout = new javax.swing.GroupLayout(tab2);
        tab2.setLayout(tab2Layout);
        tab2Layout.setHorizontalGroup(
            tab2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(tab2Layout.createSequentialGroup()
                .addGap(21, 21, 21)
                .addGroup(tab2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addGroup(tab2Layout.createSequentialGroup()
                        .addComponent(jLabel1)
                        .addGap(32, 32, 32)
                        .addGroup(tab2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel9, javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(jLabel8))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(tab2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(jTextField1, javax.swing.GroupLayout.DEFAULT_SIZE, 50, Short.MAX_VALUE)
                            .addComponent(jTextField2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(tab2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jComboBox1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jComboBox2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(18, 18, 18)
                        .addGroup(tab2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel10)
                            .addComponent(jLabel11, javax.swing.GroupLayout.Alignment.TRAILING))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(tab2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(jTextField3, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(jTextField4, javax.swing.GroupLayout.PREFERRED_SIZE, 50, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(tab2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jComboBox4, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jComboBox3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(jLabel2)
                        .addGap(18, 18, 18))
                    .addComponent(jSeparator1, javax.swing.GroupLayout.PREFERRED_SIZE, 711, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(20, Short.MAX_VALUE))
        );
        tab2Layout.setVerticalGroup(
            tab2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(tab2Layout.createSequentialGroup()
                .addGroup(tab2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(tab2Layout.createSequentialGroup()
                        .addGap(28, 28, 28)
                        .addComponent(jLabel1))
                    .addGroup(tab2Layout.createSequentialGroup()
                        .addContainerGap()
                        .addGroup(tab2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addGroup(tab2Layout.createSequentialGroup()
                                .addGroup(tab2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                    .addComponent(jTextField4, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(jLabel10)
                                    .addComponent(jComboBox3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addGroup(tab2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                    .addComponent(jComboBox4, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(jLabel11)
                                    .addComponent(jTextField3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                            .addGroup(tab2Layout.createSequentialGroup()
                                .addGroup(tab2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                    .addComponent(jTextField1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(jLabel8)
                                    .addComponent(jComboBox1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addGroup(tab2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                    .addComponent(jComboBox2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(jLabel9)
                                    .addComponent(jTextField2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))))
                    .addGroup(tab2Layout.createSequentialGroup()
                        .addGap(26, 26, 26)
                        .addComponent(jLabel2)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jSeparator1, javax.swing.GroupLayout.PREFERRED_SIZE, 10, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(477, Short.MAX_VALUE))
        );

        jTabbedPane3.addTab("View/Edit Week Summary", tab2);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jTabbedPane3, javax.swing.GroupLayout.PREFERRED_SIZE, 773, Short.MAX_VALUE)
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(jTabbedPane3, javax.swing.GroupLayout.PREFERRED_SIZE, 607, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, Short.MAX_VALUE))
        );

        pack();
    }// </editor-fold>

    private void jTextField1ActionPerformed(java.awt.event.ActionEvent evt) {
        // TODO add your handling code here:
    }

    private void jTextField2ActionPerformed(java.awt.event.ActionEvent evt) {
        // TODO add your handling code here:
    }

    private void jComboBox1ActionPerformed(java.awt.event.ActionEvent evt) {
        // TODO add your handling code here:
    }

    private void jComboBox2ActionPerformed(java.awt.event.ActionEvent evt) {
        // TODO add your handling code here:
    }

    private void jTextField3ActionPerformed(java.awt.event.ActionEvent evt) {
        // TODO add your handling code here:
    }

    private void jTextField4ActionPerformed(java.awt.event.ActionEvent evt) {
        // TODO add your handling code here:
    }

    private void jComboBox3ActionPerformed(java.awt.event.ActionEvent evt) {
        // TODO add your handling code here:
    }

    private void jComboBox4ActionPerformed(java.awt.event.ActionEvent evt) {
        // TODO add your handling code here:
    }

    void getPrefs(Preferences prefs) {
        timeWorkedToday = prefs.getLong("timeWorkedToday", 0);
        timeWorkedInWeek = prefs.getLong("timeWorkedInWeek", 0);
        lastActiveDate = prefs.getLong("lastActiveDate", 0);
        String log = prefs.get("hourLog", "noSavedHourLog");
        if (log == "noSavedHourLog") {
            initializeHourLog();
        } else {
            java.lang.reflect.Type type = new TypeToken<HashMap<Integer, ArrayList<Long>>>(){}.getType();
            hourLog = gson.fromJson(log, type);
        }
        printHourLog();

    }

    void setUIStateFromPrefs() {
        String hoursForDay = getHoursMinutesFromMs(timeWorkedToday);
        dayHours.setText(hoursForDay);
        String hoursForWeek = getHoursMinutesFromMs(timeWorkedInWeek);
        weekHours.setText(hoursForWeek);
    }

    Boolean isSameDate(ZonedDateTime date1, ZonedDateTime date2) {
        String a = date1.toString().substring(0, 10);
        String b = date2.toString().substring(0, 10);
        return a.equals(b);
    }

    void reconcileLastActiveDate() {
        ZonedDateTime currentDate = getDateFromMS(getCurrentTime());
        ZonedDateTime dateProcessing = getDateFromMS(lastActiveDate);
        while (!isSameDate(dateProcessing, currentDate)) {
            dateProcessing = dateProcessing.plusDays(1);
            timeWorkedToday = 0;

            if (dateProcessing.getDayOfWeek().getValue() == 1) { // Monday
                System.out.println("monday");
                timeWorkedInWeek = 0;
                writeLogToCSV(dateProcessing);
                initializeHourLog();
            }
        }

    }

    void writeLogToCSV(ZonedDateTime date) {
        try {
            FileWriter pw = new FileWriter("hourLog.csv", true);
            ZonedDateTime d = date.minusWeeks(1);

            for (Map.Entry<Integer, ArrayList<Long>> entry : hourLog.entrySet()) {
                // Integer k = entry.getKey();
                ArrayList<Long> v = entry.getValue();
                StringBuilder sb = new StringBuilder();
                sb.append(d.toString().substring(0, 10) + ",");
                for (int i = 0; i < v.size(); i++) {
                    int[] hm = getHoursMinutesFromDate(getDateFromMS(v.get(i)));
                    String status = i % 2 == 0 ? "IN: " : "OUT: ";
                    sb.append(status + getHourMinuteDisplay(hm[0], hm[1]) + ",");
                }
                sb.append('\n');
                pw.write(sb.toString());
                d = d.plusDays(1);
            }
            pw.close();
        } catch (IOException e) {
            e.printStackTrace();
            System.out.println(e.getMessage());
        }
    }

    String getHourMinuteDisplay(int h, int m) {
        return addLeadingZero(h) + ":" + addLeadingZero(m);
    }

    String addLeadingZero(int n) {
        if (n < 10) {
            return "0" + n;
        }
        return n + "";
    }

    static long getCurrentTime() {
        return System.currentTimeMillis();
    }

    void setInterval(int interval) {
        new Timer().scheduleAtFixedRate(new TimerTask(){
            @Override
            public void run(){
                if (isClockedIn) {
                    long time = getCurrentTime();
                    long diff = getDiffFromTimes(time, clockedInTime);
                    String hoursToday = getHoursMinutesFromMs(diff + timeWorkedToday);
                    String hoursWeek = getHoursMinutesFromMs(diff + timeWorkedInWeek);
                    dayHours.setText(hoursToday);
                    weekHours.setText(hoursWeek);
                    // TODO: if midnight, clock out and clock back in
                    // (what about reconcile ? what if sunday to monday? close app too?)
                }
            }
        },0, interval);
    }

    static ZonedDateTime getDateFromMS(long ms) {
        return ZonedDateTime.ofInstant(Instant.ofEpochMilli(ms), ZoneId.systemDefault());
    }

    static long getMSFromDate(Date date) {
        return date.toInstant().toEpochMilli();
    }

    static long getDiffFromTimes(long t1, long t2) {
        return Math.abs(t1 - t2);
    }

    static String getHoursMinutesFromMs(long ms) {
        return String.format("%d hours, %d mins, %d secs",
            TimeUnit.MILLISECONDS.toHours(ms) % 24,
            TimeUnit.MILLISECONDS.toMinutes(ms) % 60,
            TimeUnit.MILLISECONDS.toSeconds(ms) % 60
        );
    }

    static int[] getHoursMinutesFromDate(ZonedDateTime date) {
        int[] a = { date.getHour(), date.getMinute() };
        return a;
    }

    static String formatDate(Date date) {
        DateFormat df = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
        return df.format(date);
    }

    static void addTimeToLog(int day, long ms) {
        ArrayList<Long> times = hourLog.get(day);
        times.add(ms);
    }

    static void updateHourLog(int day, long ms, int index) {
        ArrayList<Long> times = hourLog.get(day);
        times.set(index, ms);
    }

    static void initializeHourLog() {
        for (int i = 1; i < 8; i++) {
            ArrayList<Long> l = new ArrayList<Long>();
            hourLog.put(i, l);
        }
    }

    static void printHourLog() {
         hourLog.forEach((k, v) -> {
            System.out.println(k + ": " + v);
        });
    }

    private void clockinBtnActionPerformed(java.awt.event.ActionEvent evt) {
        isClockedIn = !isClockedIn;
        long time = getCurrentTime();
        lastActiveDate = time;
        ZonedDateTime date = getDateFromMS(time);
        int[] hm = getHoursMinutesFromDate(date);
        clockInOutAtTime.setText(getHourMinuteDisplay(hm[0], hm[1]));
        int day = date.getDayOfWeek().getValue();
        addTimeToLog(day, time);
        printHourLog();
        if (isClockedIn) {
            clockedInTime = time;
            clockinBtn.setText("CLOCK OUT");
            clockinBtn.setBackground(new Color(254,117,54));
            clockInOutAtLabel.setText("Clocked In at:");
        } else {
            clockinBtn.setText("CLOCK IN");
            clockinBtn.setBackground(new Color(68,214,149));
            clockInOutAtLabel.setText("Clocked Out at:");
            long diff = getDiffFromTimes(time, clockedInTime);
            timeWorkedToday += diff;
            timeWorkedInWeek += diff;
            String hoursToday = getHoursMinutesFromMs(timeWorkedToday);
            String hoursWeek = getHoursMinutesFromMs(timeWorkedInWeek);
            dayHours.setText(hoursToday);
            weekHours.setText(hoursWeek);
        }

    }



    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(ClockIn.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(ClockIn.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(ClockIn.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(ClockIn.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>



        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new ClockIn().setVisible(true);

            }
        });
    }

    // Variables declaration - do not modify
    private javax.swing.JLabel clockInOutAtLabel;
    private javax.swing.JLabel clockInOutAtTime;
    private javax.swing.JButton clockinBtn;
    private javax.swing.JLabel dayHours;
    private javax.swing.JLabel dayHoursLabel;
    private javax.swing.JComboBox<String> jComboBox1;
    private javax.swing.JComboBox<String> jComboBox2;
    private javax.swing.JComboBox<String> jComboBox3;
    private javax.swing.JComboBox<String> jComboBox4;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JSeparator jSeparator1;
    private javax.swing.JSeparator jSeparator3;
    private javax.swing.JTabbedPane jTabbedPane3;
    private javax.swing.JTextField jTextField1;
    private javax.swing.JTextField jTextField2;
    private javax.swing.JTextField jTextField3;
    private javax.swing.JTextField jTextField4;
    private javax.swing.JPanel tab1;
    private javax.swing.JPanel tab2;
    private javax.swing.JLabel weekHours;
    private javax.swing.JLabel weekHoursLabel;
    // End of variables declaration
}
